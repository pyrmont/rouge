<style type="text/css">
  .legend {
    width: 200px;
    margin-right: 30px;
    float: right;
  }
</style>

<section class="legend">
  <h2>Legend</h2>
  <pre class="codehilite"><%
    Rouge::Token.each_token do |token|
      %><span class="<%= token.shortname %>"><%= token.qualname %></span>
<%      end
  %></pre>
</section>
<h2>Highlighted</h2>
<%= @highlighted %>

<h2>Raw</h2>
<pre id="rawtext"><%= CGI.escape_html(@sample) %></pre>

<script type="text/javascript">
  var errorSpans = document.querySelectorAll("code > span.err").length;
  var highlightSection = document.getElementsByClassName("highlight")[0].textContent;
  var rawSection = document.getElementById("rawtext").textContent;
  if (highlightSection != rawSection) {
    alert("Highlighted and raw section don't match!")
  }
  if (errorSpans > 0) {
    alert("There are " + errorSpans + " errors.");
  }
</script>